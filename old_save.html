<!DOCTYPE html>
<meta charset="utf-8">
<html>

<body>
<script>
d3.csv("Access_type_allcounties.csv", function (dataset) {

          var width = 250,
              height = 400,
              radius = Math.min(width, height) / 2;

          var color = d3.scale.ordinal()
                              .range(["#FFC8B7", "#EF8B6C", "#F05522", "#E0E0E0"])
                              .domain(d3.range(0,4));

          var svg = d3.select("body").append("svg")
                      .attr("width", width)
                      .attr("height", height)
                      .append("g")
                      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

          var arc = d3.svg.arc()
                      .innerRadius(radius - 50)
                      .outerRadius(radius - 20);

          var pie = d3.layout.pie()
                      .value(function(d) { return d.Alameda; })
                      .sort(null);

          var path = svg.datum(dataset).selectAll("path")
                        .data(pie)
                        .enter().append("path")
                        .attr("fill", function(d, i) { return color(i); })
                        .attr("d", arc)
                        .each(function(d) { this._current = d; })
                        .attr("data-legend",function(d) { return d.Access_type})
                        .style("display", "none");

          var legend = d3.select("body").append("svg")
          .attr("class", "legend")
          .attr("width", radius * 2)
          .attr("height", radius * 2)
          .selectAll("g")
          .data(color.domain())
          .enter().append("g")
          .attr("transform", function(d, i) { return "translate(20," + i * 20 + ")"; })
          .style("display", "none");

          legend.append("rect")
          .attr("y", Math.min(width, height) / 2 - 50)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", color);

          legend.append("text")
          .attr("x", 24)
          .attr("y", Math.min(width, height) / 2 - 41)
          .attr("dy", ".35em")
          .attr("fill", "black")
          .attr("font-size", "10px")
          .text( function (d, i) { return dataset[i].Access_type;}
          );

          d3.select("select").on("change.1", change);

          function change() {
            setValue(this.value)
          };

          function setValue (value) {
            path.style("display", null);
            legend.style("display", null);
            pie.value(function(d) { return d[value]; });
            path = path.data(pie);
            path.transition().duration(750).attrTween("d", arcTween);
          }

          updatePie1 = setValue;

          function arcTween(a) {
            var i = d3.interpolate(this._current, a);
            this._current = i(0);
            return function(t) {
              return arc(i(t));
            }
            };

          });


d3.csv("Agency_lev_allcounties.csv", function (dataset) {

               var width = 250,
                   height = 400,
                   radius = Math.min(width, height) / 2;

               var color = d3.scale.category20();

               var svg = d3.select("body").append("svg")
                           .attr("width", width)
                           .attr("height", height)
                           .append("g")
                           .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

               var arc = d3.svg.arc()
                           .innerRadius(radius - 50)
                           .outerRadius(radius - 20);

               var pie2 = d3.layout.pie()
                           .value(function(d) { return d.Alameda; })
                           .sort(null);

               var path = svg.datum(dataset).selectAll("path")
                             .data(pie2)
                             .enter().append("path")
                             .attr("fill", function(d, i) { return color(i); })
                             .attr("d", arc)
                             .each(function(d) { this._current = d; })
                             .attr("data-legend",function(d) { return d.Agency_lev})
                             .style("display", "none");

                var legend = d3.select("body").append("svg")
                .attr("class", "legend")
                .attr("width", radius * 2)
                .attr("height", radius * 2)
                .selectAll("g")
                .data(color.domain())
                .enter().append("g")
                .attr("transform", function(d, i) { return "translate(20, " + i * 20 + ")"; })
                .style("display", "none");

                legend.append("rect")
                .attr("y", Math.min(width, height) / 2 - 50)
                .attr("width", 18)
                .attr("height", 18)
                .style("fill", color);

                legend.append("text")
                .attr("x", 24)
                .attr("y", Math.min(width, height) / 2 - 41)
                .attr("dy", ".35em")
                .attr("fill", "black")
                .attr("font-size", "10px")
                .text( function (d, i) { return dataset[i].Agency_lev;}
                );

                var countyNameSvg = d3.select("body").append("svg")
                                               .attr("width", 600)
                                               .attr("height", 50)
                                               .style("display", "none");

               d3.selectAll("select").on("change.2", change);

              function change() {
                setValue(this.value);
                setCountyValue(this.properties.name);
              };

              function setValue(value) {
                path.style("display", null);
                legend.style("display", null);
                pie2.value(function(d) { return d[value]; });
                path = path.data(pie2);
                path.transition().duration(750).attrTween("d", arcTween);
              };

              function setCountyValue(name) {
                countyNameRect = countyNameSvg.style("display", null)
                              .append('rect')
                              .attr("width", 600)
                              .attr("height", 50)
                              .style('fill', "white");
                countyName = countyNameSvg.style("display", null)
                              .append("text")
                              .attr("text-anchor", "left")
                              .attr("x","0%")
                              .attr("y","50%")
                              .text(function() { return name+" County" });
              };

              updatePie2 = setValue;
              updateCountyName = setCountyValue;

              function arcTween(a) {
                var i = d3.interpolate(this._current, a);
                this._current = i(0);
                return function(t) {
                  return arc(i(t));
                }
                };

               });


  </script>

</body>

</html>
