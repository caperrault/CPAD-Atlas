<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8">

	  <title>California Protected Areas Data Portal</title>

    <meta name="description" content="">
	  <meta name="author" content="">
    <meta name="google-site-verification" content="7dej4jCbuusOJlIEYMbqRMG3b7whAst3-VM1u-qmfI4" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/base.css" />
	  <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/skeleton-fluid.css" />
	  <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/layout.css" />
    <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/smoothness/jquery-ui-1.9.1.custom.css" />
    <link rel="stylesheet" type="text/css" href="http://www.calands.org/highslide/highslide.css" />
	  <link rel="stylesheet" type="text/css" href="http://www.calands.org/css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />

    <script type="text/javascript">
		var BASE_URL = "http://www.calands.org/";
        var NAV_PAGE = "data";
	  </script>

    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
	  <script src="http://www.calands.org/js/jquery-1.9.0.min.js" type="text/javascript"></script>
	  <script src="http://www.calands.org/js/jquery-ui-1.10.0.custom.min.js" type="text/javascript"></script>
    <script src="http://www.calands.org/highslide/highslide-full_jscompress.js" type="text/javascript"></script>
	  <script src="http://www.calands.org/js/index.js" type="text/javascript"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="js/countyMap.js"></script>
    <script src="js/countyPie1.js"></script>
    <script src="js/countyPie2.js"></script>
    <script src="js/countyInfo.js"></script>

  </head>

  <body>

    <div class="container">
		    <div class="header">

           <div class="one column">&nbsp;</div>

           <div class="five columns">
             <a href="http://www.calands.org/"><img src="http://www.calands.org/images/cpad-logo-blue.png" alt="California Protected Areas Data Portal" /></a>
           </div>

	         <div id="navigation" class="nine columns">
             <p class="login"><a href="http://www.calands.org/admin">Login</a></p>
                <ul>
          			<li>
          				<a href="http://www.calands.org/data">CPAD</a>
          				<div class="dd">
          					<ul>
          						<li><a href="http://www.calands.org/data">About CPAD</a></li>
          						<li><a href="http://www.calands.org/map">CPAD Map</a></li>
          						<li><a href="http://www.calands.org/data/uses">Uses</a></li>
          						<li><a href="http://www.calands.org/data/standards">Standards</a></li>
          						<li><a href="http://www.calands.org/data/history">History</a></li>
          						<li><a href="http://www.calands.org/data/statistics">Statistics</a></li>
          						<li><a href="http://www.calands.org/data/reports">Reports</a></li>
          						<li><a href="http://www.calands.org/data/related">Related Data</a></li>
          						<li><a href="http://www.calands.org/data/faqs">FAQs</a></li>
          						<li><a href="http://www.calands.org/data/metadata">Metadata</a></li>
          					</ul>
          				</div>
          			</li>
          			<li>
          				<a href="http://www.calands.org/cced">CCED</a>
          				<div class="dd">
          					<ul>
          						<li><a href="http://www.calands.org/cced">About CCED</a></li>
          						<li><a href="http://www.calands.org/ccedmap">CCED Map</a></li>
          					</ul>
          				</div>
          			</li>
          			<li>
          				<a href="http://www.calands.org/revise">revise</a>
          			</li>
          			<li>
        				<a href="http://www.calands.org/resources">resources</a>
        			  </li>
          			<li>
          				<a href="http://www.calands.org/news">news</a>
          			</li>
          			<li>
        				<a href="http://www.calands.org/about">about</a>
        			  </li>
      		   </ul>
      	    </div>
          </div>

        <div id="main" class="page" style="">

          <div id="breadcrumbs" style="">
              <p class="breadcrumbs"><a href="http://www.calands.org/">Home</a> > <a href="http://www.calands.org/data">Data</a> > <a href="http://localhost:8000/">CPAD Atlas</a></p>
          </div>

		      <h2 style="padding-top:0;">CPAD Atlas</h2>

          <div class="content">
            <p>CPAD contains data about California lands protected for open space purposes and owned in fee by agencies and organizations. More than <strong>49,000,000 acres</strong> of protected land are now inventoried in CPAD. The land is owned by more than <strong>900 government agencies, non-profit and other organizations</strong>, for the CPAD 2014a (February 2014) release.</p>
          </div>

          <h3>CPAD Data per County</h3>

          <div id="countyChapter">

            <div class="content">
              <p>California counties are inequally wealthy in protected areas. The map below shows the distribution of protected areas throughout the 58 counties, either in terms of <strong>total acreage</strong> or <strong>acreage per inhabitant</strong>. <strong>Click on any county on the map or in the table</strong> to take a deeper look into its protected areas.</p>
            </div>

            <form id="nav" class="switch switch-blue">
                <input type="radio" class="div2" name="viewTab" id="week2" checked>
                <label for="week2" class="switch-label switch-label-off">Map View</label>
                <input type="radio" class="div1" name="viewTab" id="month2">
                <label for="month2" class="switch-label switch-label-on">Table View</label>
              <span class="switch-selection"></span>
            </form>

            <div id="tabs">

            <div id="div2" class="tab">

              <div id="countyMap" class="map">

              <div>
                <form class="mapScale">
                  <label><input type="Radio" name="dataset" id="ac_tot" class="radio" value="ac_tot"> Total CPAD Acreage</label>
                  <label><input type="Radio" name="dataset" id="POP_NORM" class="radio" value="POP_NORM"> CPAD Acres per Inhabitant</label>
                </form>
              </div>

                <svg id="countyMapSvg" class="ca"></svg>

              </div>

            </div>

            <div id="div1" class="tab">

            <svg id="countyHeaders"></svg>

              <div id="countyTable" class="table">

              <svg id="countyIndex" class="cell"></svg>

              <svg id="countyRow"></svg>

                <script>

                var index = [];
                for (var i = 1; i < 59; i++) {index.push(i);}

                var indexRect = d3.select("#countyIndex").selectAll("rect")
                                 .data(index)
                                 .enter()
                                 .append("rect")
                                 .attr("y", function(d, i) {return i * 21;})
                                 .attr("x", 0)
                                 .attr("width", 20)
                                 .attr("height", 21)
                                 .attr("fill", "white")
                                 .classed("tableHeader", "true");

                var indexNumber = d3.select("#countyIndex").selectAll("text")
                             .data(index)
                             .enter()
                             .append("text")
                             .attr("y", function(d, i) {return (i*21) + 14;})
                             .attr("x", 10)
                             .attr("width", 20)
                             .attr("height", 21)
                             .attr("font-weight", "bold")
                             .text(function (d, i) {return d;});

                var width = 500,
                    height = 1000;

                var fieldHeight = 20;
                var fieldWidth = 145;

                var canvasH = d3.select("#countyHeaders")
                    .attr("width", width)
                    .attr("height", fieldHeight)
                    .attr("x", 20)
                    .append("g");

                var canvasR = d3.select("#countyRow")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g");

                var headerGrp = canvasH.append("g")
                                .attr("class", "headerGrp")
                                .attr("x", 20);

                var rowsGrp = canvasR.append("g")
                              .attr("class","rowsGrp");

                var previousSort = null;

                d3.json("Counties_stats_3col.json", function(data) {

                refreshTable(null);

                function refreshTable(sortOn){

                  // create the table header
                  var header = headerGrp.selectAll("g")
                    .data(d3.keys(data[0]))
                    .enter().append("g")
                    .attr("class", "tableHeader")
                    .attr("transform", function (d, i){
                      return "translate("+ i* fieldWidth + ",0)";
                    });

                  header.append("rect")
                    .attr("width", fieldWidth + 30)
                    .attr("height", fieldHeight);

                  header.append("text")
                    .attr("x", fieldWidth/2 + 25)
                    .attr("y", fieldHeight/2)
                    .attr("dy", ".35em")
                    .text(function (d) { return d;})
                    .style("cursor", function (d, i) {
                        if (i>0) { return "s-resize";}
                        else { return "default";}
                      })
                    .on("click", function (d, i) { if (i>0) {
                      d3.select(".tableHeaderSelected").classed("tableHeaderSelected", false);
                      d3.select(this).classed("tableHeaderSelected", true);
                      return refreshTable(d);
                      }
                    });

                  // fill the table
                  // select rows
                  var rows = rowsGrp.selectAll("g.Tcounty").data(data,
                    function(d){ return d.County; });

                  // create rows
                  var rowsEnter = rows.enter().append("svg:g")
                    .attr("class", "Tcounty")
                    .attr("transform", function (d, i){
                      return "translate(0," + (i) * (fieldHeight+1) + ")";
                    })
                    .on("click", function(d) {
                                            selectedCounty = d.County;
                                            countyClass(d.County);
                                            updatePie1(d.County);
                                            updatePie2(d.County);
                                            updateCountyName(d.County);
                                            updateCountyTot(d3.format(",")(d["Total CPAD Acreage"]));
                                            updateCountyInh(d3.format(",")(d["CPAD Acres per 1,000 Inh."]));
                                          });

                  // select cells
                  var cells = rows.selectAll("g.cell").data(function(d){return d3.values(d);});

                  // create cells
                  var cellsEnter = cells.enter().append("svg:g")
                    .attr("class", "cell")
                    .attr("class", "Tcounty")
                    .attr("transform", function (d, i){
                      return "translate(" + i * fieldWidth + ",0)";
                    });

                  cellsEnter.append("rect")
                    .attr("width", fieldWidth)
                    .attr("height", fieldHeight);

                  cellsEnter.append("text")
                    .attr("x", fieldWidth / 2)
                    .attr("y", fieldHeight / 2)
                    .attr("dy", ".35em")
                    .text( function (d) { if (typeof d == "number") {
                      return d3.format(',')(d);}
                      else {return d;}
                      });

                  //update if not in initialisation
                  if(sortOn !== null) {
                      // update rows
                      rows.sort(function(a,b){return sort(b[sortOn], a[sortOn]);});
                      previousSort = null;

                      rows.transition()
                        .duration(500)
                        .attr("transform", function (d, i){
                          return "translate(0," + (i) * (fieldHeight+1) + ")";
                        });
                  }
                }

                function sort(a,b){
                    return a > b ? 1 : a == b ? 0 : -1;
                }

                });

                var updatePie1;
                var updatePie2;
                var updateCountyName;
                var updateCountyTot;
                var updateCountyInh;

                </script>

              </svg>

              <script type="text/javascript" >

              (function(){
              var tabs = document.getElementById("tabs");
              var nav = $("input:radio[name=viewTab]").click(function() {
                    var value = $(this).val();
                    });

              //Hide all tabs
              function hideTab1(){
              var tab1 = document.getElementById("div1");
                tab1.className = tab1.className + " hide";
              }

              function hideTab2(){
              var tab2 = document.getElementById("div2");
                tab2.className = tab2.className + " hide";
              }

              //hide tabs on load
              hideTab1();
              hideTab2();

              function hideTabs(){
              var tab = tabs.getElementsByTagName("div");
              for(var i=0;i<=nav.length+1;i++){
              if(tab[i].className == "tab"){
                tab[i].className = tab[i].className + " hide";
              }
              }
              }

              //Show the clicked tab
              function showTab(tab){
              document.getElementById(tab).className = "tab";
              }

              //Add click events
              for(var i=0;i<nav.length;i++){
              nav[i].onclick = function(){
              hideTabs();
              showTab(this.className);
              }
              }

              showTab("div2");
              }) ();

              </script>
            </div>

            </div>
          </div>

            <div id="countyPies" class="pie">

              <svg id="countyName" class="selectedElement" style="height: 40px; width: 100%;"></svg>

              <svg id="countyTot" class="selectedElement" style="height: 20px; width: 100%;"></svg>

              <svg id="countyInh" class="selectedElement" style="height: 20px; width: 100%;"></svg>

              <svg id="countyPie1" class="pieChart" style="height: 210px; width: 100%;"></svg>

              <svg id="countyPie2" class="pieChart" style="height: 260px; width: 100%;"></svg>

            </div>

          </div>

    </div>
  </body>
</html>
